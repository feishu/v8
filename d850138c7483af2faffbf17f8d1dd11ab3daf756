{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3fc3290d_7b70ef61",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1183894
      },
      "writtenOn": "2024-10-28T06:40:52Z",
      "side": 1,
      "message": "Simon, Philip, can you take a look please?",
      "revId": "d850138c7483af2faffbf17f8d1dd11ab3daf756",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "47a71b8a_8d2112d9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1323977
      },
      "writtenOn": "2024-10-28T07:12:06Z",
      "side": 1,
      "message": "Thanks a lot for looking into this. I especially appreciate the lengths you went to add a regression test.\n\nI\u0027m not sure this is the right fix so please see the comment in-line.",
      "revId": "d850138c7483af2faffbf17f8d1dd11ab3daf756",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aba77aca_3028ff0d",
        "filename": "src/debug/debug.cc",
        "patchSetId": 4
      },
      "lineNbr": 2240,
      "author": {
        "id": 1323977
      },
      "writtenOn": "2024-10-28T07:12:06Z",
      "side": 1,
      "message": "I\u0027m not sure this is the right fix. The fundamental problem is that we fail to recompile a script originating from `::CompileFunction`. That node.js recompiles the script as a module is immaterial. For the crash to reproduce it should be enough to GC the `Script` produced by `::CompileFunction` and then attempt to set a breakpoint. This should already cause the crash. It\u0027s fine if that recompilation again fails with a parse error, but we should not crash.\n\nThe underlying crash happens because we configure the recompile wrongly. There is a missmatch between the parser/compile options from the initial compilation and how we re-compile here.\n\nI think the right fix would be to adjust `CompileTopLevel` to account for wrapped scripts and re-compile using `::CompileFunction` instead of a normal script compile. Could you try to see if that\u0027s possible?",
      "range": {
        "startLine": 2240,
        "startChar": 8,
        "endLine": 2240,
        "endChar": 40
      },
      "revId": "d850138c7483af2faffbf17f8d1dd11ab3daf756",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d3836e30_e6e6b73a",
        "filename": "src/debug/debug.cc",
        "patchSetId": 4
      },
      "lineNbr": 2240,
      "author": {
        "id": 3213273
      },
      "writtenOn": "2024-10-29T00:23:24Z",
      "side": 1,
      "message": "Thank you for your insights. I agree; it does seem incorrect to exclude only wrapped scripts from recompilation. I\u0027ll try making adjustments to allow recompile for wrapped scripts as well.",
      "parentUuid": "aba77aca_3028ff0d",
      "range": {
        "startLine": 2240,
        "startChar": 8,
        "endLine": 2240,
        "endChar": 40
      },
      "revId": "d850138c7483af2faffbf17f8d1dd11ab3daf756",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5d4c0b1d_f9d3eaf6",
        "filename": "src/debug/debug.cc",
        "patchSetId": 4
      },
      "lineNbr": 2240,
      "author": {
        "id": 3213273
      },
      "writtenOn": "2024-11-02T15:19:09Z",
      "side": 1,
      "message": "compileFunction is executed inside the compileToplevel.",
      "parentUuid": "d3836e30_e6e6b73a",
      "range": {
        "startLine": 2240,
        "startChar": 8,
        "endLine": 2240,
        "endChar": 40
      },
      "revId": "d850138c7483af2faffbf17f8d1dd11ab3daf756",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ce250750_ea370e8d",
        "filename": "src/debug/debug.cc",
        "patchSetId": 4
      },
      "lineNbr": 2240,
      "author": {
        "id": 1323977
      },
      "writtenOn": "2024-11-05T12:28:54Z",
      "side": 1,
      "message": "I talked to V8 folks, and unfortunately this is not something we can fix. To re-compile the wrapped script correctly you not only need the stashed away original wrapped arguments, but also the outer SFI in which the original function was compiled. We currently only have the args:\n\nhttps://source.chromium.org/chromium/chromium/src/+/main:v8/src/objects/script.tq;l\u003d47-48;drc\u003dcc09cc9195b326dee8a24881eed9f670b4916969\n\nI think the best solution for now is to also bail on recompilation of wrapped scripts, similar to how we bail for eval scripts.",
      "parentUuid": "5d4c0b1d_f9d3eaf6",
      "range": {
        "startLine": 2240,
        "startChar": 8,
        "endLine": 2240,
        "endChar": 40
      },
      "revId": "d850138c7483af2faffbf17f8d1dd11ab3daf756",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a8467cc1_bfab68dd",
        "filename": "src/debug/debug.cc",
        "patchSetId": 4
      },
      "lineNbr": 2240,
      "author": {
        "id": 3213273
      },
      "writtenOn": "2024-11-06T12:39:21Z",
      "side": 1,
      "message": "Iâ€™ve made the modifications.",
      "parentUuid": "ce250750_ea370e8d",
      "range": {
        "startLine": 2240,
        "startChar": 8,
        "endLine": 2240,
        "endChar": 40
      },
      "revId": "d850138c7483af2faffbf17f8d1dd11ab3daf756",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9323e89c_23d2e981",
        "filename": "src/debug/debug.cc",
        "patchSetId": 4
      },
      "lineNbr": 2240,
      "author": {
        "id": 1323977
      },
      "writtenOn": "2024-11-07T15:47:39Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "a8467cc1_bfab68dd",
      "range": {
        "startLine": 2240,
        "startChar": 8,
        "endLine": 2240,
        "endChar": 40
      },
      "revId": "d850138c7483af2faffbf17f8d1dd11ab3daf756",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5416ca87_cedff0b4",
        "filename": "test/inspector/debugger/fail-compile-wrapped-and-recompile-module.js",
        "patchSetId": 4
      },
      "lineNbr": 1,
      "author": {
        "id": 1323977
      },
      "writtenOn": "2024-10-28T07:12:06Z",
      "side": 1,
      "message": "super nit: 2024 ðŸ˜Š",
      "range": {
        "startLine": 1,
        "startChar": 13,
        "endLine": 1,
        "endChar": 17
      },
      "revId": "d850138c7483af2faffbf17f8d1dd11ab3daf756",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e6bde5e8_5cfead12",
        "filename": "test/inspector/debugger/fail-compile-wrapped-and-recompile-module.js",
        "patchSetId": 4
      },
      "lineNbr": 1,
      "author": {
        "id": 1323977
      },
      "writtenOn": "2024-11-07T15:47:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5416ca87_cedff0b4",
      "range": {
        "startLine": 1,
        "startChar": 13,
        "endLine": 1,
        "endChar": 17
      },
      "revId": "d850138c7483af2faffbf17f8d1dd11ab3daf756",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}